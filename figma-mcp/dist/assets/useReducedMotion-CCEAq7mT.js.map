{"version":3,"file":"useReducedMotion-CCEAq7mT.js","sources":["../../src/api/jobs.ts","../../src/hooks/useJobPolling.ts","../../src/hooks/useReducedMotion.ts"],"sourcesContent":["import { apiClient } from './client';\nimport { JobStatus, AgentType } from '@/stores/jobStore';\n\nexport interface CreateJobResponse {\n    jobId: string;\n    status: JobStatus;\n}\n\nexport interface JobStatusResponse {\n    jobId: string;\n    status: JobStatus;\n    currentAgent: AgentType | null;\n    progress: number;\n    logs: string[];\n    error?: string;\n}\n\nexport const jobsApi = {\n    /**\n     * Initialize a new analysis job\n     */\n    createJob: async (uploadId: string): Promise<CreateJobResponse> => {\n        const { data } = await apiClient.post<CreateJobResponse>('/jobs', { uploadId });\n        return data;\n    },\n\n    /**\n     * Poll for job status updates\n     */\n    getJobStatus: async (jobId: string): Promise<JobStatusResponse> => {\n        const { data } = await apiClient.get<JobStatusResponse>(`/jobs/${jobId}`);\n        return data;\n    },\n\n    /**\n     * Simulate job for demo mode (mock)\n     */\n    simulateJob: async (jobId: string): Promise<void> => {\n        await apiClient.post(`/jobs/${jobId}/simulate`);\n    }\n};\n","import { useQuery, useMutation } from '@tanstack/react-query';\nimport { jobsApi } from '@/api/jobs';\nimport { useJobStore } from '@/stores/jobStore';\nimport { useEffect } from 'react';\nimport { ApiClientError } from '@/api/client';\n\nconst JOB_POLL_INTERVAL = 2000; // 2 seconds\n\nexport const useJobPolling = () => {\n    const {\n        jobId,\n        status,\n        createJob: setStoreJob,\n        updateStatus,\n        setAgent,\n        setProgress,\n        addLog,\n        failJob\n    } = useJobStore();\n\n    // Mutation to create a job\n    const createJobMutation = useMutation({\n        mutationFn: jobsApi.createJob,\n        onSuccess: (data) => {\n            setStoreJob(data.jobId);\n        },\n        onError: (error: ApiClientError) => {\n            failJob(error.message);\n        }\n    });\n\n    // Query to poll job status\n    const { data: jobStatus, error } = useQuery({\n        queryKey: ['job', jobId],\n        queryFn: () => jobsApi.getJobStatus(jobId!),\n        enabled: !!jobId && status !== 'completed' && status !== 'failed',\n        refetchInterval: (query) => {\n            const data = query.state.data;\n            if (data?.status === 'completed' || data?.status === 'failed') {\n                return false;\n            }\n            return JOB_POLL_INTERVAL;\n        },\n        refetchIntervalInBackground: true,\n    });\n\n    // Sync Query Data to Store\n    useEffect(() => {\n        if (jobStatus) {\n            updateStatus(jobStatus.status);\n            setProgress(jobStatus.progress);\n\n            if (jobStatus.currentAgent) {\n                setAgent(jobStatus.currentAgent);\n            }\n\n            // Add new logs (rudimentary deduping via length check would be better, but this suffices for now)\n            if (jobStatus.logs && jobStatus.logs.length > 0) {\n                const latestLog = jobStatus.logs[jobStatus.logs.length - 1];\n                if (latestLog) addLog(latestLog); // Simply adding latest for stream effect\n            }\n        }\n    }, [jobStatus, updateStatus, setProgress, setAgent, addLog]);\n\n    // Handle Polling Errors\n    useEffect(() => {\n        if (error) {\n            failJob((error as unknown as ApiClientError).message);\n        }\n    }, [error, failJob]);\n\n    return {\n        createJob: createJobMutation.mutate,\n        isCreating: createJobMutation.isPending,\n        jobStatus,\n        error\n    };\n};\n","import { useState, useEffect } from 'react';\n\n/**\n * Hook to detect user's reduced motion preference\n * \n * Respects prefers-reduced-motion media query for accessibility.\n * Returns true if user prefers reduced motion.\n */\nexport function useReducedMotion(): boolean {\n    const [prefersReducedMotion, setPrefersReducedMotion] = useState(() => {\n        if (typeof window === 'undefined') return false;\n        return window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n    });\n\n    useEffect(() => {\n        const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n        \n        const handleChange = (event: MediaQueryListEvent) => {\n            setPrefersReducedMotion(event.matches);\n        };\n\n        // Modern browsers\n        if (mediaQuery.addEventListener) {\n            mediaQuery.addEventListener('change', handleChange);\n            return () => mediaQuery.removeEventListener('change', handleChange);\n        }\n        \n        // Legacy browsers\n        mediaQuery.addListener(handleChange);\n        return () => mediaQuery.removeListener(handleChange);\n    }, []);\n\n    return prefersReducedMotion;\n}\n"],"names":["jobsApi","uploadId","data","apiClient","jobId","JOB_POLL_INTERVAL","useJobPolling","status","setStoreJob","updateStatus","setAgent","setProgress","addLog","failJob","useJobStore","createJobMutation","useMutation","error","jobStatus","useQuery","query","useEffect","latestLog","useReducedMotion","prefersReducedMotion","setPrefersReducedMotion","useState","mediaQuery","handleChange","event"],"mappings":"sLAiBO,MAAMA,EAAU,CAInB,UAAW,MAAOC,GAAiD,CAC/D,KAAM,CAAE,KAAAC,GAAS,MAAMC,EAAU,KAAwB,QAAS,CAAE,SAAAF,EAAU,EAC9E,OAAOC,CACX,EAKA,aAAc,MAAOE,GAA8C,CAC/D,KAAM,CAAE,KAAAF,GAAS,MAAMC,EAAU,IAAuB,SAASC,CAAK,EAAE,EACxE,OAAOF,CACX,EAKA,YAAa,MAAOE,GAAiC,CACjD,MAAMD,EAAU,KAAK,SAASC,CAAK,WAAW,CAClD,CACJ,EClCMC,EAAoB,IAEbC,EAAgB,IAAM,CAC/B,KAAM,CACF,MAAAF,EACA,OAAAG,EACA,UAAWC,EACX,aAAAC,EACA,SAAAC,EACA,YAAAC,EACA,OAAAC,EACA,QAAAC,CAAA,EACAC,EAAA,EAGEC,EAAoBC,EAAY,CAClC,WAAYhB,EAAQ,UACpB,UAAYE,GAAS,CACjBM,EAAYN,EAAK,KAAK,CAC1B,EACA,QAAUe,GAA0B,CAChCJ,EAAQI,EAAM,OAAO,CACzB,CAAA,CACH,EAGK,CAAE,KAAMC,EAAW,MAAAD,CAAA,EAAUE,EAAS,CACxC,SAAU,CAAC,MAAOf,CAAK,EACvB,QAAS,IAAMJ,EAAQ,aAAaI,CAAM,EAC1C,QAAS,CAAC,CAACA,GAASG,IAAW,aAAeA,IAAW,SACzD,gBAAkBa,GAAU,CACxB,MAAMlB,EAAOkB,EAAM,MAAM,KACzB,OAAIlB,GAAA,YAAAA,EAAM,UAAW,cAAeA,GAAA,YAAAA,EAAM,UAAW,SAC1C,GAEJG,CACX,EACA,4BAA6B,EAAA,CAChC,EAGDgB,OAAAA,EAAAA,UAAU,IAAM,CACZ,GAAIH,IACAT,EAAaS,EAAU,MAAM,EAC7BP,EAAYO,EAAU,QAAQ,EAE1BA,EAAU,cACVR,EAASQ,EAAU,YAAY,EAI/BA,EAAU,MAAQA,EAAU,KAAK,OAAS,GAAG,CAC7C,MAAMI,EAAYJ,EAAU,KAAKA,EAAU,KAAK,OAAS,CAAC,EACtDI,KAAkBA,CAAS,CACnC,CAER,EAAG,CAACJ,EAAWT,EAAcE,EAAaD,EAAUE,CAAM,CAAC,EAG3DS,EAAAA,UAAU,IAAM,CACRJ,GACAJ,EAASI,EAAoC,OAAO,CAE5D,EAAG,CAACA,EAAOJ,CAAO,CAAC,EAEZ,CACH,UAAWE,EAAkB,OAC7B,WAAYA,EAAkB,UAC9B,UAAAG,EACA,MAAAD,CAAA,CAER,ECrEO,SAASM,GAA4B,CACxC,KAAM,CAACC,EAAsBC,CAAuB,EAAIC,EAAAA,SAAS,IACzD,OAAO,OAAW,IAAoB,GACnC,OAAO,WAAW,kCAAkC,EAAE,OAChE,EAEDL,OAAAA,EAAAA,UAAU,IAAM,CACZ,MAAMM,EAAa,OAAO,WAAW,kCAAkC,EAEjEC,EAAgBC,GAA+B,CACjDJ,EAAwBI,EAAM,OAAO,CACzC,EAGA,OAAIF,EAAW,kBACXA,EAAW,iBAAiB,SAAUC,CAAY,EAC3C,IAAMD,EAAW,oBAAoB,SAAUC,CAAY,IAItED,EAAW,YAAYC,CAAY,EAC5B,IAAMD,EAAW,eAAeC,CAAY,EACvD,EAAG,CAAA,CAAE,EAEEJ,CACX"}